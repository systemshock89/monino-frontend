{"version":3,"file":"../widgetPhone.min.js","sources":["widgetPhone.min.js"],"sourcesContent":["\"use strict\";\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", function() {\r\n    widgetPhone();\r\n\r\n    try {\r\n        Fancybox.bind(\"[data-fancybox].widget-phone\", { // включать значок при закрытии попапа\r\n            dragToClose: getComputedStyle(document.querySelector('.header__mobile')).display === 'flex' ? false : true, // bug: click to button misses on mobile\r\n            on: {\r\n                reveal: (fancybox, slide) => {\r\n                    const formId = slide.el.querySelector('form').getAttribute('id');\r\n                    initSubmitForm(formId);\r\n                },\r\n                close: () => {\r\n                    document.querySelector('.widget-phone').classList.add('widget-phone__active');\r\n                },\r\n            },\r\n        });\r\n    } catch (err) {\r\n        console.log(err);\r\n    }\r\n\r\n});\r\n\r\nfunction widgetPhone(){\r\n    const popupTimer = 45000, // таймер, по истечении которого автоматически вызовется попап\r\n        widgetTimer = 4000, // таймер, по истечении которого появится виджет\r\n        cookieTimer = 1; // таймер действия куки (в сутках)\r\n\r\n    let widgetPopupOpenFlag = false; // определяет, был ли открыт попап хотя бы 1 раз\r\n\r\n    document.querySelector('.widgets-right').insertAdjacentHTML('afterbegin', `\r\n    <div class=\"widget-phone-wrap\">\r\n        <button data-fancybox data-type=\"ajax\" class=\"widget-phone\" data-src=\"forms/modal-widget-phone.html\" title=\"Обратный звонок\">\r\n            <span class=\"widget__circles\"><svg><use xlink:href=\"img/sprite.svg#phone\"></use></svg></span>\r\n        </button>\r\n    </div>\r\n    `);\r\n\r\n    const widgetPhone = document.querySelector('.widget-phone');\r\n\r\n    //показываем виджет через 5 сек после загрузки страницы\r\n    setTimeout(function(){\r\n        widgetPhone.classList.add('widget-phone__active');\r\n    },widgetTimer);\r\n\r\n    //клик по виджету\r\n    widgetPhone.addEventListener('click', () => {\r\n        clickWidgetPhonePopup(widgetPhone); //вызываем функцию\r\n    });\r\n\r\n    // Если попап еще ни разу не был открыт (нет куки widget_phone_popup_show)\r\n    try {\r\n        if( !Cookies.get('widget_phone_popup_show') ){\r\n            setTimeout(function(){\r\n                // И если попап не открывали вручную и в данный момент не открыто никакого другого попапа\r\n                if (!widgetPopupOpenFlag && !document.documentElement.classList.contains('with-fancybox') ){\r\n                    // то смотри функцию\r\n                    clickWidgetPhonePopup(widgetPhone, 1);\r\n                }\r\n            },popupTimer);\r\n        }\r\n    } catch (err) {\r\n        console.log(err);\r\n    }\r\n\r\n    //ф-я при вызове попапа виджета\r\n    function clickWidgetPhonePopup(widgetPhone, no_click_to_btn){\r\n        widgetPopupOpenFlag = true;\r\n\r\n        // То открываем этот попап (спустя 45 сек нахождения на странице)\r\n        // (опять же, если нет куки widget_phone_popup_show)\r\n        // Проверяем куку для того, чтобы попап не открывался на каждой странице сайта, если было открыто несколько вкладок.\r\n        try {\r\n            if( !Cookies.get('widget_phone_popup_show') ){\r\n                if(no_click_to_btn){ // если попап вызывается автоматически, а не кликом по кнопке, то скриптом кликаем по кнопке\r\n                    widgetPhone.click(); //вызываем попап\r\n                }\r\n            }\r\n        } catch (err) {\r\n            console.log(err);\r\n        }\r\n        widgetPhone.classList.remove('widget-phone__active');\r\n\r\n        // и ставим куку на сутки, показывающую, что попап был открыт\r\n        try {\r\n            Cookies.set('widget_phone_popup_show', 'true', { expires: cookieTimer });\r\n        } catch (err) {\r\n            console.log(err);\r\n        }\r\n\r\n    }\r\n}"],"names":["widgetPhone","let","widgetPopupOpenFlag","document","querySelector","insertAdjacentHTML","setTimeout","classList","add","addEventListener","clickWidgetPhonePopup","Cookies","get","documentElement","contains","err","console","log","no_click_to_btn","click","remove","set","expires","Fancybox","bind","dragToClose","getComputedStyle","display","on","reveal","fancybox","slide","formId","el","getAttribute","initSubmitForm","close"],"mappings":"AAAA,aAwBA,SAASA,cAKLC,IAAIC,EAAsB,CAAA,EAE1BC,SAASC,cAAc,gBAAgB,EAAEC,mBAAmB;;;;;;KAM3D,EAED,MAAML,EAAcG,SAASC,cAAc,eAAe,EAG1DE,WAAW,WACPN,EAAYO,UAAUC,IAAI,sBAAsB,CACpD,EAlBkB,GAkBL,EAGbR,EAAYS,iBAAiB,QAAS,KAClCC,EAAsBV,CAAW,CACrC,CAAC,EAGD,IACSW,QAAQC,IAAI,yBAAyB,GACtCN,WAAW,WAEFJ,GAAwBC,SAASU,gBAAgBN,UAAUO,SAAS,eAAe,GAEpFJ,EAAsBV,EAAa,CAAC,CAE5C,EAnCW,IAmCC,CAIpB,CAFE,MAAOe,GACLC,QAAQC,IAAIF,CAAG,CACnB,CAGA,SAASL,EAAsBV,EAAakB,GACxChB,EAAsB,CAAA,EAKtB,IACSS,QAAQC,IAAI,yBAAyB,GACnCM,GACClB,EAAYmB,MAAM,CAK9B,CAFE,MAAOJ,GACLC,QAAQC,IAAIF,CAAG,CACnB,CACAf,EAAYO,UAAUa,OAAO,sBAAsB,EAGnD,IACIT,QAAQU,IAAI,0BAA2B,OAAQ,CAAEC,QA3DvC,CA2D4D,CAAC,CAG3E,CAFE,MAAOP,GACLC,QAAQC,IAAIF,CAAG,CACnB,CAEJ,CACJ,CA1FAZ,SAASM,iBAAiB,mBAAoB,WAC1CT,YAAY,EAEZ,IACIuB,SAASC,KAAK,+BAAgC,CAC1CC,YAAqF,SAAxEC,iBAAiBvB,SAASC,cAAc,iBAAiB,CAAC,EAAEuB,QACzEC,GAAI,CACAC,OAAQ,CAACC,EAAUC,KACTC,EAASD,EAAME,GAAG7B,cAAc,MAAM,EAAE8B,aAAa,IAAI,EAC/DC,eAAeH,CAAM,CACzB,EACAI,MAAO,KACHjC,SAASC,cAAc,eAAe,EAAEG,UAAUC,IAAI,sBAAsB,CAChF,CACJ,CACJ,CAAC,CAGL,CAFE,MAAOO,GACLC,QAAQC,IAAIF,CAAG,CACnB,CAEJ,CAAC"}