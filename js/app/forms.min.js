"use strict";function initSubmitForm(s){const f=document.forms[s],m=f.dataset.extKey,u=f.querySelector(".form__button"),l=f.querySelector(".form__field_personal");let _;var e;l&&(_=l.querySelector(".checkbox__input")),f.addEventListener("submit",t=>{t.preventDefault();let o=0,r=0,e=!1;if(!l||_.checked?e=!0:l.classList.add("form__field_error"),f.querySelectorAll(".valid_req").forEach(e=>{""!==e.value&&"0"!==e.value||(e.closest(".form__field").classList.add("form__field_error"),o=1)}),f.querySelectorAll(".form__field_fio .valid_req").forEach(e=>{e.value&&!isValidFio(e.value)&&(e.closest(".form__field").classList.add("form__field_error"),o=1)}),f.querySelectorAll(".valid_mail").forEach(e=>{e.value&&!isValidEmailAddress(e.value)&&(e.closest(".form__field").classList.add("form__field_error"),r=1)}),f.querySelectorAll(".valid_phone").forEach(e=>{e.value&&!isValidTel(e.value)&&(e.closest(".form__field").classList.add("form__field_error"),r=1)}),!o&&!r&&e){u.disabled=!0,showLoader();let e="Ваша заявка отправлена!";t=u.dataset.text_send,t=(""!=t&&(e=t),u.dataset.type_send);let l=u.dataset.yam;var a=f.querySelector(".id_target_ym");a&&""!=a.value&&(l=a.value);const i=u.dataset.open_in_popap;if(f.querySelector(".form_sp_sec").value="f2d2g54j5y2f5","ajax"==t){var n,c,d=[];for([n,c]of new FormData(f).entries())d.push({name:n,value:c});fetch("/form_fmc/api/add.php?ext_key="+m,{method:"POST",cache:"no-cache",body:JSON.stringify({send_ajax:1,file_exist:0,data:d}),headers:{"Content-Type":"application/json"}}).then(e=>e.text()).then(t=>{if("ZAKAZ1CLICK"==l){window.dataLayer=window.dataLayer||[];var o=document.querySelector(".modal_order"),r=new URLSearchParams(document.querySelector(".seo-btn-tovar-inner").dataset.src).get("ext_var[tovarid]"),a=o.querySelector(".form__field_name div").textContent;let e;e=o.querySelector(".form__field_price .nowrap")?parseInt(o.querySelector(".form__field_price .nowrap").textContent.replace(/[^0-9]/gi,""),10):0,dataLayer.push({ecommerce:{currencyCode:"RUB",purchase:{actionField:{id:t},products:[{id:r,name:a,price:e,quantity:1}]}}})}0<t?(clearFormData(s),closeFormPopap(l,e,s,i)):(hideLoader(),"long"==t?(alert("Вы слишком быстро вводите данные формы! Сработала защита от спама. Попробуйте еще раз."),u.disabled=!1,f.reset()):0==t&&(alert("Сработала защита от взлома!"),u.disabled=!1,f.reset()))}).catch(e=>{console.error("Error:",e)})}"reboot"==t&&(clearFormData(s),goYaM(l),formSendRedirect(),setTimeout(function(){f.submit()},1e3))}}),"1"==f.querySelector(".form_fmc_nf_time").dataset.emb&&(e=Math.floor(Date.now()/1e3),f.querySelector(".form_fmc_nf_time").value=e),"1"==f.querySelector(".form_fmc_page_from").dataset.emb&&(f.querySelector(".form_fmc_page_from").value=window.location.href),phoneInput("input[type=tel]"),f.querySelectorAll(".form-control, .checkbox__input, .radio__input").forEach(t=>{t.addEventListener("focus",()=>{var e=t.closest(".form__field_error");e&&e.classList.remove("form__field_error")})}),f.querySelectorAll(".form__field").forEach(e=>{e.addEventListener("click",()=>{e.classList.remove("form__field_error")})}),l&&_.addEventListener("click",()=>{_.checked&&l.classList.remove("form__field_error")}),setupFormHandlers(s),loadFormData(s)}function closeFormPopap(e,t,o,r){const a=document.forms[o];goYaM(e),formSendRedirect(),a.querySelectorAll(".form__field_error").forEach(e=>e.classList.remove("form__field_error")),a.reset(),setTimeout(function(){Fancybox.close(),a.querySelector(".form__button").disabled=!1},1e3)}function goYaM(e){"undefined"!=typeof yaC&&e&&(ym(yaC,"reachGoal",e),"undefined"!=typeof dataLayer)&&dataLayer.push({event:e}),"undefined"!=typeof dataLayer&&dataLayer.push({event:"formsend"})}function isValidEmailAddress(e){return/^[\S]+@[a-z0-9-]+\.[a-z]{2,}$/i.test(e)}function isValidFio(e){return/^[a-zа-яё]+$/i.test(e)}function isValidTel(e){return/^(\+7|8)\s\(\d{3}\)\s\d{3}-\d{2}-\d{2}|\+\d+$/i.test(e)}function fancybox_success_message(e){hideLoader(),new Fancybox([{src:'<div class="modal modal_success"><div class="form__title">Спасибо!</div><div class="modal__text">'+e+'</div><button class="button form__button" data-fancybox-close >Ok</button></div>',type:"html"}],{autoFocus:!1})}function formSendRedirect(){hideLoader(),window.location.href=window.location.origin+"/formSend/"}function saveFormData(e){var t={},o=document.forms[e];for(let e=0;e<o.elements.length;e++){var r=o.elements[e];r.name&&("checkbox"===r.type||"radio"===r.type?t[r.name]=String(r.checked):t[r.name]=r.value)}localStorage.setItem(e,JSON.stringify(t))}function clearFormData(e){localStorage.removeItem(e)}function loadFormData(e){var t=JSON.parse(localStorage.getItem(e));if(t){var o=document.forms[e];for(let e=0;e<o.elements.length;e++){var r=o.elements[e];r.name&&t[r.name]&&("checkbox"===r.type||"radio"===r.type?r.checked="true"===t[r.name]:r.value=t[r.name])}}}function setupFormHandlers(t){var o=document.forms[t];for(let e=0;e<o.elements.length;e++){var r=o.elements[e];("INPUT"===r.tagName&&"checkbox"!==r.type&&"radio"!==r.type&&"hidden"!==r.type||"TEXTAREA"===r.tagName)&&r.addEventListener("keyup",function(){saveFormData(t)}),"SELECT"===r.tagName&&r.addEventListener("change",function(){saveFormData(t)}),"checkbox"!==r.type&&"radio"!==r.type||r.addEventListener("click",function(){saveFormData(t)})}}document.addEventListener("DOMContentLoaded",function(){try{Fancybox.bind("[data-fancybox]:where(.button, .button2, .footer__form)",{dragToClose:"flex"!==getComputedStyle(document.querySelector(".header__mobile")).display,on:{reveal:(e,t)=>{initSubmitForm(t.el.querySelector("form").getAttribute("id")),t.contentEl.classList.contains("modal_cost")&&formFieldProductButton(e,t)}}})}catch(e){console.log(e)}});let iclon=1;function formFieldProductButton(e,t){document.querySelector(".form__field_product-button").addEventListener("click",e=>{e.preventDefault();e=document.querySelector(".form__field-wrapper_product").cloneNode(!0);e.querySelector(".form-control_select").setAttribute("id","104_"+iclon),e.querySelector(".form-control_select").setAttribute("name","field_104_"+iclon),e.querySelector(".form__field_size input[type=text]").setAttribute("name","field_109_"+iclon),e.querySelector(".form__field_size input[type=text]").setAttribute("id","109_"+iclon),document.querySelector(".form__field-wrapper_product:nth-last-child(2)").after(e),iclon++})}
//# sourceMappingURL=maps/forms.min.js.map
